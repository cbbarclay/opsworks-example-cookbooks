global
    log 127.0.0.1 local0 notice
    user haproxy
    group haproxy

defaults
    log global
    retries 2
    timeout connect 3000
    timeout server 5000
    timeout client 5000
        
listen mysql-cluster
    bind 127.0.0.1:3306
    mode tcp
    option mysql-check user haproxy_check
    balance roundrobin
    <% node[:opsworks][:stack][:rds_instances].each do |instance| %>
    server <%= instance[:db_instance_identifier] %> <%= instance[:address] %>:3306 check
    <% end %>

